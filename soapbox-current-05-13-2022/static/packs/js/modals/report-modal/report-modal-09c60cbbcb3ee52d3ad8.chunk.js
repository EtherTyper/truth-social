"use strict";(self.webpackChunksoapbox_fe=self.webpackChunksoapbox_fe||[]).push([[204],{1053:function(e,t,r){r.r(t),r.d(t,{default:function(){return W}});var n,o,a=r(1821),i=(r(1),r(0)),s=r(1815),d=r(583),u=r(1827),c=r(16),l=r(147),g=r(28),f=r(206),p=r(274),m=r(2),h=r(23),v=r(4),Z=r(53),b=(0,s.vU)({title:{id:"report.confirmation.title",defaultMessage:"Thanks for submitting your report."},content:{id:"report.confirmation.content",defaultMessage:"If we find that this account is violating the {link} we will take further action on the matter."}}),k=(0,a.Z)(u.Z,{id:"shared.tos",defaultMessage:"Terms of Service"}),w=r(602),y=r(3),x=r(214),M=r(414),C=r(863),_=r.n(C),E=r(278),T=r(30),I=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return I(t,e),t.prototype.render=function(){var e=this.props,t=e.status,r=e.checked,n=e.onToggle,o=e.disabled,i=null;if(t.get("reblog"))return null;if(t.get("media_attachments").size>0)if(t.get("media_attachments").some((function(e){return"unknown"===e.get("type")})));else if("video"===t.getIn(["media_attachments",0,"type"])){var s=t.getIn(["media_attachments",0]);i=(0,a.Z)(E.Z,{fetchComponent:T.nk,loading:this.renderLoadingVideoPlayer},void 0,(function(e){return(0,a.Z)(e,{preview:s.get("preview_url"),blurhash:s.get("blurhash"),src:s.get("url"),alt:s.get("description"),aspectRatio:s.getIn(["meta","original","aspect"]),width:239,height:110,inline:!0,sensitive:t.get("sensitive"),onOpenVideo:_()})}))}else if("audio"===t.getIn(["media_attachments",0,"type"])){var d=t.getIn(["media_attachments",0]);i=(0,a.Z)(E.Z,{fetchComponent:T.Bb,loading:this.renderLoadingAudioPlayer},void 0,(function(e){return(0,a.Z)(e,{src:d.get("url"),alt:d.get("description"),inline:!0,sensitive:t.get("sensitive"),onOpenAudio:_()})}))}else i=(0,a.Z)(E.Z,{fetchComponent:T.ew,loading:this.renderLoadingMediaGallery},void 0,(function(e){return(0,a.Z)(e,{media:t.get("media_attachments"),sensitive:t.get("sensitive"),height:110,onOpenMedia:_()})}));return(0,a.Z)("div",{className:"status-check-box"},void 0,(0,a.Z)("div",{className:"status-check-box__status"},void 0,(0,a.Z)(p.Z,{status:t}),i),(0,a.Z)("div",{className:"status-check-box-toggle"},void 0,(0,a.Z)(x.Z,{checked:r,onChange:n,disabled:o,icons:!1})))},t}(i.PureComponent),A=O,S=(0,y.$j)((function(e,t){var r=t.id;return{status:e.getIn(["statuses",r]),checked:e.getIn(["reports","new","status_ids"],(0,w.Set)()).includes(r)}}),(function(e,t){var r=t.id;return{onToggle:function(t){e((0,l.cm)(r,t.target.checked))}}}))(A),N=r(38),z=(0,s.vU)({addAdditionalStatuses:{id:"report.otherActions.addAdditionl",defaultMessage:"Would you like to add additional statuses to this report?"},addMore:{id:"report.otherActions.addMore",defaultMessage:"Add more"},furtherActions:{id:"report.otherActions.furtherActions",defaultMessage:"Further actions:"},hideAdditonalStatuses:{id:"report.otherActions.hideAdditional",defaultMessage:"Hide additional statuses"},otherStatuses:{id:"report.otherActions.otherStatuses",defaultMessage:"Include other statuses?"}}),G=r(6),R=r.n(G),H=(0,s.vU)({placeholder:{id:"report.placeholder",defaultMessage:"Additional comments"},reasonForReporting:{id:"report.reason.title",defaultMessage:"Reason for reporting"}}),q=(0,s.vU)({blankslate:{id:"report.reason.blankslate",defaultMessage:"You have removed all statuses from being selected."},done:{id:"report.done",defaultMessage:"Done"},next:{id:"report.next",defaultMessage:"Next"},close:{id:"lightbox.close",defaultMessage:"Close"},placeholder:{id:"report.placeholder",defaultMessage:"Additional comments"},submit:{id:"report.submit",defaultMessage:"Submit"}});!function(e){e.ONE="ONE",e.TWO="TWO",e.THREE="THREE"}(o||(o={}));var j={ONE:function(e){var t=(0,y.I0)(),r=(0,d.Z)(),n=(0,i.useRef)(null),o=(0,i.useState)(!1),s=o[0],u=o[1],c=(0,i.useState)(!0),g=c[0],f=c[1],p=(0,v.CG)((function(e){return e.reports.getIn(["new","comment"])})),h=(0,v.CG)((function(e){return e.rules.items})),Z=(0,v.CG)((function(e){return e.reports.getIn(["new","rule_ids"])})),b=h.length>0,k=(0,v.CG)((function(e){return e.reports.getIn(["new","status_ids"])})),w=(0,i.useMemo)((function(){return 0===k.size}),[]);return(0,i.useEffect)((function(){t((0,M.j)())}),[]),(0,i.useEffect)((function(){h.length>0&&n.current&&n.current.clientHeight<=385&&u(!0)}),[h,n.current]),(0,a.Z)(m.Kq,{space:4},void 0,b&&(0,a.Z)(m.Kq,{space:2},void 0,(0,a.Z)(m.xv,{size:"xl",weight:"semibold",tag:"h1"},void 0,r.formatMessage(H.reasonForReporting)),(0,a.Z)("div",{className:"relative"},void 0,i.createElement("div",{style:{maxHeight:385},className:"rounded-lg -space-y-px overflow-y-auto",onScroll:function(){if(n.current){var e=n.current,t=e.scrollTop,r=e.scrollHeight,o=e.clientHeight;u(t+o>r-24),f(t<24)}},ref:n},h.filter((function(e){var t=w?"account":"content";return!e.rule_type||e.rule_type===t})).map((function(e,r){var n=Z.includes(String(e.id));return(0,a.Z)("button",{"data-testid":"rule-".concat(e.id),onClick:function(){return t((0,l.Nr)(e.id))},className:R()({"relative border border-solid border-gray-200 dark:border-slate-900/75 hover:bg-gray-50 dark:hover:bg-slate-900/50 text-left w-full p-4 flex justify-between items-center cursor-pointer":!0,"rounded-tl-lg rounded-tr-lg":0===r,"rounded-bl-lg rounded-br-lg":r===h.length-1,"bg-gray-50 dark:bg-slate-900":n})},r,(0,a.Z)(m.Kq,{className:"mr-3"},void 0,(0,a.Z)(m.xv,{tag:"span",size:"sm",weight:"medium",theme:n?"primary":"default"},void 0,e.text),(0,a.Z)(m.xv,{tag:"span",theme:"muted",size:"sm"},void 0,e.subtext)),(0,a.Z)("input",{name:"reason",type:"checkbox",value:e.id,checked:n,readOnly:!0,className:"h-4 w-4 cursor-pointer text-primary-600 dark:text-primary-400 border-gray-300 rounded focus:ring-primary-500"}))}))),(0,a.Z)("div",{className:R()("inset-x-0 top-0 flex rounded-t-lg justify-center bg-gradient-to-b from-white pb-12 pt-8 pointer-events-none dark:from-slate-900 absolute transition-opacity duration-500",{"opacity-0":g,"opacity-100":!g})}),(0,a.Z)("div",{className:R()("inset-x-0 bottom-0 flex rounded-b-lg justify-center bg-gradient-to-t from-white pt-12 pb-8 pointer-events-none dark:from-slate-900 absolute transition-opacity duration-500",{"opacity-0":s,"opacity-100":!s})}))),(0,a.Z)(m.cw,{labelText:r.formatMessage(H.placeholder)},void 0,(0,a.Z)(m.gx,{placeholder:r.formatMessage(H.placeholder),value:p,onChange:function(e){t((0,l.Ck)(e.target.value))}})))},TWO:function(e){var t=e.account,n=(0,y.I0)(),o=(0,v.hz)(),s=(0,d.Z)(),c=(0,v.CG)((function(e){return(0,w.OrderedSet)(e.timelines.getIn(["account:".concat(t.id,":with_replies"),"items"])).union(e.reports.getIn(["new","status_ids"]))})),g=(0,v.CG)((function(e){return e.reports.getIn(["new","block"])})),f=(0,v.CG)((function(e){return e.reports.getIn(["new","forward"])})),p=(0,N.Q1)(t)&&o.federating,h=(0,v.CG)((function(e){return e.reports.getIn(["new","isSubmitting"])})),Z=(0,i.useState)(!1),b=Z[0],k=Z[1];return(0,i.useEffect)((function(){n((0,M.j)())}),[]),(0,a.Z)(m.Kq,{space:4},void 0,o.reportMultipleStatuses&&(0,a.Z)(m.Kq,{space:2},void 0,(0,a.Z)(m.xv,{tag:"h1",size:"xl",weight:"semibold"},void 0,s.formatMessage(z.otherStatuses)),(0,a.Z)(m.cw,{labelText:s.formatMessage(z.addAdditionalStatuses)},void 0,b?(0,a.Z)(m.Kq,{space:2},void 0,(0,a.Z)("div",{className:"bg-gray-100 rounded-lg p-4"},void 0,c.map((function(e){return(0,a.Z)(S,{id:e},e)}))),(0,a.Z)("div",{},void 0,(0,a.Z)(m.zx,{icon:r(594),theme:"secondary",size:"sm",onClick:function(){return k(!1)}},void 0,s.formatMessage(z.hideAdditonalStatuses)))):(0,a.Z)(m.zx,{icon:r(48),theme:"secondary",size:"sm",onClick:function(){return k(!0)}},void 0,s.formatMessage(z.addMore)))),(0,a.Z)(m.Kq,{space:2},void 0,(0,a.Z)(m.xv,{tag:"h1",size:"xl",weight:"semibold"},void 0,s.formatMessage(z.furtherActions)),(0,a.Z)(m.cw,{labelText:(0,a.Z)(u.Z,{id:"report.block_hint",defaultMessage:"Do you also want to block this account?"})},void 0,(0,a.Z)(m.Ug,{space:2,alignItems:"center"},void 0,(0,a.Z)(x.Z,{checked:g,onChange:function(e){n((0,l.LG)(e.target.checked))},icons:!1,id:"report-block"}),(0,a.Z)(m.xv,{theme:"muted",tag:"label",size:"sm",htmlFor:"report-block"},void 0,(0,a.Z)(u.Z,{id:"report.block",defaultMessage:"Block {target}",values:{target:"@".concat(t.get("acct"))}})))),p&&(0,a.Z)(m.cw,{labelText:(0,a.Z)(u.Z,{id:"report.forward_hint",defaultMessage:"The account is from another server. Send a copy of the report there as well?"})},void 0,(0,a.Z)(m.Ug,{space:2,alignItems:"center"},void 0,(0,a.Z)(x.Z,{checked:f,onChange:function(e){n((0,l.$p)(e.target.checked))},icons:!1,id:"report-forward",disabled:h}),(0,a.Z)(m.xv,{theme:"muted",tag:"label",size:"sm",htmlFor:"report-forward"},void 0,(0,a.Z)(u.Z,{id:"report.forward",defaultMessage:"Forward to {target}",values:{target:(0,N.ge)(t)}}))))))},THREE:function(e){e.account;var t,r=(0,d.Z)(),n=(0,v.CG)((function(e){return(0,Z.UX)(e).get("links")}));return(0,a.Z)(m.Kq,{space:1},void 0,(0,a.Z)(m.xv,{weight:"semibold",tag:"h1",size:"xl"},void 0,r.formatMessage(b.title)),(0,a.Z)(m.xv,{},void 0,r.formatMessage(b.content,{link:n.get("termsOfService")?(t=n.get("termsOfService"),(0,a.Z)("a",{href:t,target:"_blank",className:"hover:underline text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-500"},void 0,k)):k})))}},K=function(e){var t=e.statusId,r=(0,v.CG)((function(e){return e.statuses.get(t)}));return r?(0,a.Z)(m.Kq,{space:2,className:"p-4 rounded-lg bg-gray-100 dark:bg-slate-700"},void 0,(0,a.Z)(h.Z,{id:r.get("account"),showProfileHoverCard:!1,timestamp:r.get("created_at"),hideActions:!0}),(0,a.Z)(p.Z,{status:r,expanded:!0,collapsable:!0}),r.get("media_attachments").size>0&&(0,a.Z)(f.Z,{compact:!0,media:r.get("media_attachments"),sensitive:r.get("sensitive")})):null},W=function(e){var t=e.onClose,r=(0,v.TL)(),n=(0,d.Z)(),s=(0,v.CG)((function(e){return e.reports.getIn(["new","account_id"])})),f=(0,v.mA)(s),p=(0,v.CG)((function(e){return e.reports.getIn(["new","block"])})),h=(0,v.CG)((function(e){return e.reports.getIn(["new","isSubmitting"])})),Z=(0,v.CG)((function(e){return e.rules.items})),b=(0,v.CG)((function(e){return e.reports.getIn(["new","rule_ids"])})),k=(0,v.CG)((function(e){return e.reports.getIn(["new","status_ids"])})),w=(0,i.useMemo)((function(){return 0===k.size}),[]),y=Z.length>0,x=(0,i.useState)(o.ONE),M=x[0],C=x[1],_=(0,i.useCallback)((function(){return 0===k.size?(0,a.Z)("div",{className:"bg-gray-100 dark:bg-slate-700 p-4 rounded-lg flex items-center justify-center w-full"},void 0,(0,a.Z)(m.xv,{theme:"muted"},void 0,n.formatMessage(q.blankslate))):(0,a.Z)(K,{statusId:k.first()})}),[k.size]),E=(0,i.useMemo)((function(){switch(M){case o.TWO:return n.formatMessage(q.submit);case o.THREE:return n.formatMessage(q.done);default:return n.formatMessage(q.next)}}),[M]),T=(0,i.useMemo)((function(){return M!==o.THREE&&(h||y&&b.isEmpty()||!w&&0===k.size)}),[M,h,y,b,k.size,w]),I=(0,i.useCallback)((function(){switch(M){case o.ONE:return.33;case o.TWO:return.66;case o.THREE:return 1;default:return 0}}),[M]);if((0,i.useEffect)((function(){f&&r((0,g.Cn)(f.id,{withReplies:!0,maxId:null}))}),[f]),!f)return null;var O=j[M];return(0,a.Z)(m.u_,{title:(0,a.Z)(u.Z,{id:"report.target",defaultMessage:"Reporting {target}",values:{target:(0,a.Z)("strong",{},void 0,"@",f.acct)}}),onClose:t,cancelAction:M===o.THREE?void 0:t,confirmationAction:function(){switch(M){case o.ONE:C(o.TWO);break;case o.TWO:r((0,l.ZD)()).then((function(){return C(o.THREE)})).catch((function(e){return r((0,l.rC)(e))})),p&&f&&r((0,c.Gy)(f.id));break;case o.THREE:r((0,l.rq)()),t()}},confirmationText:E,confirmationDisabled:T,skipFocus:!0},void 0,(0,a.Z)(m.Kq,{space:4},void 0,(0,a.Z)(m.ko,{progress:I()}),M!==o.THREE&&!w&&_(),(0,a.Z)(O,{account:f})))}}}]);
//# sourceMappingURL=report-modal-09c60cbbcb3ee52d3ad8.chunk.js.map