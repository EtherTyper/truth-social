"use strict";(self.webpackChunksoapbox_fe=self.webpackChunksoapbox_fe||[]).push([[9],{1106:function(e,t,a){a.r(t);var n=a(1821),i=(a(1),a(602)),o=a(0),s=a(1815),r=a(583),d=a(1811),c=a(37),u=a(1849),l=a(2),v=a(23),m=a(4),p=(0,s.vU)({title:{id:"admin.latest_accounts_panel.title",defaultMessage:"Latest Accounts"},expand:{id:"admin.latest_accounts_panel.more",defaultMessage:"Click to see {count} {count, plural, one {account} other {accounts}}"}});t.default=function(e){var t=e.limit,a=void 0===t?5:t,s=(0,r.Z)(),g=(0,d.k6)(),Z=(0,m.TL)(),f=(0,m.CG)((function(e){return e.admin.get("latestUsers").take(a)})),h=(0,m.CG)((function(e){return f.every((function(t){return!!e.accounts.getIn([t,"created_at"])}))})),_=(0,o.useState)(f.size),b=_[0],M=_[1];(0,o.useEffect)((function(){Z((0,c.uh)(["local","active"],1,null,a)).then((function(e){M(e.count)})).catch((function(){}))}),[]);var w=f.sort(u.Z).reverse();return h&&(0,i.is)(f,w)&&f&&!f.isEmpty()?(0,n.Z)(l.$L,{title:s.formatMessage(p.title),onActionClick:function(){g.push("/soapbox/admin/users")},actionTitle:s.formatMessage(p.expand,{count:b})},void 0,f.take(a).map((function(e){return(0,n.Z)(v.Z,{id:e,withRelationship:!1,withDate:!0},e)}))):null}},1093:function(e,t,a){a.r(t),a.d(t,{default:function(){return ee}});var n=a(1821),i=a(1815),o=a(583),s=a(1811),r=a(4),d=a(24),c=a(2),u=(0,i.vU)({dashboard:{id:"admin_nav.dashboard",defaultMessage:"Dashboard"},reports:{id:"admin_nav.reports",defaultMessage:"Reports"},waitlist:{id:"admin_nav.awaiting_approval",defaultMessage:"Waitlist"}}),l=function(){var e=(0,o.Z)(),t=(0,s.$B)(),a=(0,r.CG)((function(e){return e.admin.awaitingApproval.count()})),i=(0,r.CG)((function(e){return e.admin.openReports.count()})),d=[{name:"/soapbox/admin",text:e.formatMessage(u.dashboard),to:"/soapbox/admin"},{name:"/soapbox/admin/reports",text:e.formatMessage(u.reports),to:"/soapbox/admin/reports",count:i},{name:"/soapbox/admin/approval",text:e.formatMessage(u.waitlist),to:"/soapbox/admin/approval",count:a}];return(0,n.Z)(c.mQ,{items:d,activeItem:t.path})},v=(a(1),a(0)),m=a(37),p=a(21),g=a(17),Z=a(34),f=a(11),h=a(196),_=(0,i.vU)({approved:{id:"admin.awaiting_approval.approved_message",defaultMessage:"{acct} was approved!"},rejected:{id:"admin.awaiting_approval.rejected_message",defaultMessage:"{acct} was rejected."}}),b=(0,f.Tm)(),M=function(e){var t=e.accountId,i=(0,o.Z)(),s=(0,r.TL)(),d=(0,r.CG)((function(e){return b(e,t)}));return d?(0,n.Z)("div",{className:"unapproved-account"},void 0,(0,n.Z)("div",{className:"unapproved-account__bio"},void 0,(0,n.Z)("div",{className:"unapproved-account__nickname"},void 0,"@",d.get("acct")),(0,n.Z)("blockquote",{className:"md"},void 0,d.pleroma.getIn(["admin","registration_reason"],""))),(0,n.Z)("div",{className:"unapproved-account__actions"},void 0,(0,n.Z)(Z.Z,{src:a(175),onClick:function(){s((0,m.Yh)([d.id])).then((function(){var e=i.formatMessage(_.approved,{acct:"@".concat(d.acct)});s(g.ZP.success(e))})).catch((function(){}))}}),(0,n.Z)(Z.Z,{src:a(26),onClick:function(){s((0,h.FI)(i,d.id,(function(){var e=i.formatMessage(_.rejected,{acct:"@".concat(d.acct)});s(g.ZP.info(e))})))}}))):null},w=(0,i.vU)({heading:{id:"column.admin.awaiting_approval",defaultMessage:"Awaiting Approval"},emptyMessage:{id:"admin.awaiting_approval.empty_message",defaultMessage:"There is nobody waiting for approval. When a new user signs up, you can review them here."}}),x=function(){var e=(0,o.Z)(),t=(0,r.TL)(),a=(0,r.CG)((function(e){return e.admin.awaitingApproval})),i=(0,v.useState)(!0),s=i[0],d=i[1];(0,v.useEffect)((function(){t((0,m.uh)(["local","need_approval"])).then((function(){return d(!1)})).catch((function(){}))}),[]);var c=s&&0===a.count();return(0,n.Z)(p.Z,{isLoading:s,showLoading:c,scrollKey:"awaiting-approval",emptyMessage:e.formatMessage(w.emptyMessage)},void 0,a.map((function(e){return(0,n.Z)(M,{accountId:e},e)})))},k=(a(32),a(1827)),N=a(970),y=a(9),C=a(276),I=a.n(C),U=a(14),L=a(1820),R=a(158),T=(0,i.vU)({saved:{id:"admin.dashboard.settings_saved",defaultMessage:"Settings saved!"}}),A=function(){var e=(0,o.Z)(),t=(0,r.TL)(),a=(0,r.CG)((function(e){return(t=e.instance).approval_required&&t.registrations?"approval":t.registrations?"open":"closed";var t}));return(0,n.Z)(R.NA,{},void 0,(0,n.Z)(R.H_,{},void 0,(0,n.Z)(R.Ee,{label:(0,n.Z)(k.Z,{id:"admin.dashboard.registration_mode_label",defaultMessage:"Registrations"}),onChange:function(a){var n=function(e){return[{group:":pleroma",key:":instance",value:{open:[{tuple:[":registrations_open",!0]},{tuple:[":account_approval_required",!1]}],approval:[{tuple:[":registrations_open",!0]},{tuple:[":account_approval_required",!0]}],closed:[{tuple:[":registrations_open",!1]}]}[e]}]}(a.target.value);t((0,m.rF)(n)).then((function(){t(g.ZP.success(e.formatMessage(T.saved)))})).catch((function(){}))}},void 0,(0,n.Z)(R.Rk,{label:(0,n.Z)(k.Z,{id:"admin.dashboard.registration_mode.open_label",defaultMessage:"Open"}),hint:(0,n.Z)(k.Z,{id:"admin.dashboard.registration_mode.open_hint",defaultMessage:"Anyone can join."}),checked:"open"===a,value:"open"}),(0,n.Z)(R.Rk,{label:(0,n.Z)(k.Z,{id:"admin.dashboard.registration_mode.approval_label",defaultMessage:"Approval Required"}),hint:(0,n.Z)(k.Z,{id:"admin.dashboard.registration_mode.approval_hint",defaultMessage:"Users can sign up, but their account only gets activated when an admin approves it."}),checked:"approval"===a,value:"approval"}),(0,n.Z)(R.Rk,{label:(0,n.Z)(k.Z,{id:"admin.dashboard.registration_mode.closed_label",defaultMessage:"Closed"}),hint:(0,n.Z)(k.Z,{id:"admin.dashboard.registration_mode.closed_hint",defaultMessage:"Nobody can sign up. You can still invite people."}),checked:"closed"===a,value:"closed"}))))},j=function(e,t){var a=URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=a,n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove()},D=function(){var e=(0,r.TL)(),t=(0,r.CG)((function(e){return e.instance})),a=(0,r.hz)(),o=(0,r.Tr)(),s=(0,U.wy)(t.version),d=t.stats.get("user_count"),u=t.stats.get("status_count"),l=t.stats.get("domain_count"),m=t.pleroma.getIn(["stats","mau"]),p=d&&m?Math.round(m/d*100):null;return o?v.createElement(v.Fragment,null,(0,n.Z)("div",{className:"dashcounters mt-8"},void 0,(0,L.hj)(m)&&(0,n.Z)("div",{className:"dashcounter"},void 0,(0,n.Z)(c.xv,{align:"center",size:"2xl",weight:"medium"},void 0,(0,n.Z)(i.BK,{value:m})),(0,n.Z)(c.xv,{align:"center"},void 0,(0,n.Z)(k.Z,{id:"admin.dashcounters.mau_label",defaultMessage:"monthly active users"}))),(0,L.hj)(d)&&(0,n.Z)(N.rU,{className:"dashcounter",to:"/soapbox/admin/users"},void 0,(0,n.Z)(c.xv,{align:"center",size:"2xl",weight:"medium"},void 0,(0,n.Z)(i.BK,{value:d})),(0,n.Z)(c.xv,{align:"center"},void 0,(0,n.Z)(k.Z,{id:"admin.dashcounters.user_count_label",defaultMessage:"total users"}))),(0,L.hj)(p)&&(0,n.Z)("div",{className:"dashcounter"},void 0,(0,n.Z)(c.xv,{align:"center",size:"2xl",weight:"medium"},void 0,p,"%"),(0,n.Z)(c.xv,{align:"center"},void 0,(0,n.Z)(k.Z,{id:"admin.dashcounters.retention_label",defaultMessage:"user retention"}))),(0,L.hj)(u)&&(0,n.Z)(N.rU,{className:"dashcounter",to:"/timeline/local"},void 0,(0,n.Z)(c.xv,{align:"center",size:"2xl",weight:"medium"},void 0,(0,n.Z)(i.BK,{value:u})),(0,n.Z)(c.xv,{align:"center"},void 0,(0,n.Z)(k.Z,{id:"admin.dashcounters.status_count_label",defaultMessage:"posts"}))),(0,L.hj)(l)&&(0,n.Z)("div",{className:"dashcounter"},void 0,(0,n.Z)(c.xv,{align:"center",size:"2xl",weight:"medium"},void 0,(0,n.Z)(i.BK,{value:l})),(0,n.Z)(c.xv,{align:"center"},void 0,(0,n.Z)(k.Z,{id:"admin.dashcounters.domain_count_label",defaultMessage:"peers"})))),o.admin&&(0,n.Z)(A,{}),(0,n.Z)("div",{className:"dashwidgets"},void 0,(0,n.Z)("div",{className:"dashwidget"},void 0,(0,n.Z)("h4",{},void 0,(0,n.Z)(k.Z,{id:"admin.dashwidgets.software_header",defaultMessage:"Software"})),(0,n.Z)("ul",{},void 0,(0,n.Z)("li",{},void 0,I().displayName," ",(0,n.Z)("span",{className:"pull-right"},void 0,I().version)),(0,n.Z)("li",{},void 0,s.software+(s.build?"+".concat(s.build):"")," ",(0,n.Z)("span",{className:"pull-right"},void 0,s.version)))),a.emailList&&o.admin&&(0,n.Z)("div",{className:"dashwidget"},void 0,(0,n.Z)("h4",{},void 0,(0,n.Z)(k.Z,{id:"admin.dashwidgets.email_list_header",defaultMessage:"Email list"})),(0,n.Z)("ul",{},void 0,(0,n.Z)("li",{},void 0,(0,n.Z)("a",{href:"#",onClick:function(t){e((function(e,t){return(0,y.ZP)(t).get("/api/v1/pleroma/admin/email_list/subscribers.csv")})).then((function(e){j(e,"subscribers.csv")})).catch((function(){})),t.preventDefault()},target:"_blank"},void 0,"subscribers.csv")),(0,n.Z)("li",{},void 0,(0,n.Z)("a",{href:"#",onClick:function(t){e((function(e,t){return(0,y.ZP)(t).get("/api/v1/pleroma/admin/email_list/unsubscribers.csv")})).then((function(e){j(e,"unsubscribers.csv")})).catch((function(){})),t.preventDefault()},target:"_blank"},void 0,"unsubscribers.csv")),(0,n.Z)("li",{},void 0,(0,n.Z)("a",{href:"#",onClick:function(t){e((function(e,t){return(0,y.ZP)(t).get("/api/v1/pleroma/admin/email_list/combined.csv")})).then((function(e){j(e,"combined.csv")})).catch((function(){})),t.preventDefault()},target:"_blank"},void 0,"combined.csv")))))):null},S=a(40),P=a(193),z=a(146),E=a(228),G=a(863),q=a.n(G),B=a(1828),K=a(274),O=a(278),W=a(30),F=(0,i.vU)({viewStatus:{id:"admin.reports.actions.view_status",defaultMessage:"View post"},deleteStatus:{id:"admin.statuses.actions.delete_status",defaultMessage:"Delete post"}}),H=function(e){var t,i=e.status,s=(0,o.Z)(),d=(0,r.TL)(),c=function(e,t){d((0,B.h7)("MEDIA",{media:e,index:t}))},u=function(){var e=i.media_attachments.get(0);if(e&&!i.media_attachments.some((function(e){return"unknown"===e.type}))){if("video"===e.type){var t=e;return(0,n.Z)(O.Z,{fetchComponent:W.nk},void 0,(function(e){return(0,n.Z)(e,{preview:t.preview_url,blurhash:t.blurhash,src:t.url,alt:t.description,aspectRatio:t.meta.getIn(["original","aspect"]),width:239,height:110,inline:!0,sensitive:i.sensitive,onOpenVideo:q()})}))}if("audio"===e.type){var a=e;return(0,n.Z)(O.Z,{fetchComponent:W.Bb},void 0,(function(e){return(0,n.Z)(e,{src:a.url,alt:a.description,inline:!0,sensitive:i.sensitive,onOpenAudio:q()})}))}return(0,n.Z)(O.Z,{fetchComponent:W.ew},void 0,(function(e){return(0,n.Z)(e,{media:i.media_attachments,sensitive:i.sensitive,height:110,onOpenMedia:c})}))}return null}(),l=(t=i.getIn(["account","acct"]),[{text:s.formatMessage(F.viewStatus,{acct:"@".concat(t)}),to:"/@".concat(t,"/posts/").concat(i.get("id")),icon:a(217)},{text:s.formatMessage(F.deleteStatus,{acct:"@".concat(t)}),action:function(){d((0,h.Uj)(s,i.id))},icon:a(58),destructive:!0}]);return(0,n.Z)("div",{className:"admin-report__status"},void 0,(0,n.Z)("div",{className:"admin-report__status-content"},void 0,(0,n.Z)(K.Z,{status:i}),u),(0,n.Z)("div",{className:"admin-report__status-actions"},void 0,(0,n.Z)(z.Z,{items:l,src:a(229)})))},V=(0,i.vU)({reportClosed:{id:"admin.reports.report_closed_message",defaultMessage:"Report on @{name} was closed"},deactivateUser:{id:"admin.users.actions.deactivate_user",defaultMessage:"Deactivate @{name}"},deleteUser:{id:"admin.users.actions.delete_user",defaultMessage:"Delete @{name}"}}),Y=function(e){var t=e.report,i=(0,o.Z)(),s=(0,r.TL)(),d=(0,v.useState)(!1),u=d[0],l=d[1],p=function(){s((0,m.DI)([t.get("id")])).then((function(){var e=i.formatMessage(V.reportClosed,{name:t.getIn(["account","username"])});s(g.ZP.success(e))})).catch((function(){}))},Z=[{text:i.formatMessage(V.deactivateUser,{name:t.getIn(["account","username"])}),action:function(){var e=t.getIn(["account","id"]);s((0,h.yM)(i,e,(function(){return p()})))},icon:a(197)},{text:i.formatMessage(V.deleteUser,{name:t.getIn(["account","username"])}),action:function(){var e=t.getIn(["account","id"]);s((0,h.rx)(i,e,(function(){return p()})))},icon:a(224)}],f=t.get("statuses"),_=f.count(),b=t.getIn(["account","acct"]),M=t.getIn(["actor","acct"]);return(0,n.Z)("div",{className:"admin-report"},t.get("id"),(0,n.Z)("div",{className:"admin-report__avatar"},void 0,(0,n.Z)(P.ZP,{accountId:t.getIn(["account","id"]),inline:!0},void 0,(0,n.Z)(N.rU,{to:"/@".concat(b),title:b},void 0,(0,n.Z)(S.Z,{account:t.get("account"),size:32})))),(0,n.Z)("div",{className:"admin-report__content"},void 0,(0,n.Z)("h4",{className:"admin-report__title"},void 0,(0,n.Z)(k.Z,{id:"admin.reports.report_title",defaultMessage:"Report on {acct}",values:{acct:(0,n.Z)(P.ZP,{accountId:t.getIn(["account","id"]),inline:!0},void 0,(0,n.Z)(N.rU,{to:"/@".concat(b),title:b},void 0,"@",b))}})),(0,n.Z)("div",{className:"admin-report__statuses"},void 0,_>0&&(0,n.Z)(E.Z,{headline:"Reported posts (".concat(_,")"),expanded:u,onToggle:function(e){l(e)}},void 0,f.map((function(e){return(0,n.Z)(H,{report:t,status:e},e.id)})))),(0,n.Z)("div",{className:"admin-report__quote"},void 0,t.get("content","").length>0&&(0,n.Z)("blockquote",{className:"md",dangerouslySetInnerHTML:{__html:t.get("content")}}),(0,n.Z)("span",{className:"byline"},void 0,"â€”",(0,n.Z)(P.ZP,{accountId:t.getIn(["actor","id"]),inline:!0},void 0,(0,n.Z)(N.rU,{to:"/@".concat(M),title:M},void 0,"@",M))))),(0,n.Z)(c.Ug,{space:2,alignItems:"start"},void 0,(0,n.Z)(c.zx,{onClick:p},void 0,(0,n.Z)(k.Z,{id:"admin.reports.actions.close",defaultMessage:"Close"})),(0,n.Z)(z.Z,{items:Z,src:a(229)})))},$=(0,i.vU)({heading:{id:"column.admin.reports",defaultMessage:"Reports"},modlog:{id:"column.admin.reports.menu.moderation_log",defaultMessage:"Moderation Log"},emptyMessage:{id:"admin.reports.empty_message",defaultMessage:"There are no open reports. If a user gets reported, they will show up here."}}),Q=(0,f.Fg)(),J=function(){var e=(0,o.Z)(),t=(0,r.TL)(),a=(0,v.useState)(!0),i=a[0],s=a[1],d=(0,r.CG)((function(e){return e.admin.openReports.toList().map((function(t){return Q(e,t)}))}));(0,v.useEffect)((function(){t((0,m.RC)()).then((function(){return s(!1)})).catch((function(){}))}),[]);var c=i&&0===d.count();return(0,n.Z)(p.Z,{isLoading:i,showLoading:c,scrollKey:"admin-reports",emptyMessage:e.formatMessage($.emptyMessage)},void 0,d.map((function(e){return(0,n.Z)(Y,{report:e},e.get("id"))})))},X=(0,i.vU)({heading:{id:"column.admin.dashboard",defaultMessage:"Dashboard"}}),ee=function(){var e=(0,o.Z)();return(0,r.Tr)()?(0,n.Z)(d.Z,{label:e.formatMessage(X.heading),withHeader:!1},void 0,(0,n.Z)(l,{}),(0,n.Z)(s.rs,{},void 0,(0,n.Z)(s.AW,{path:"/soapbox/admin",exact:!0,component:D}),(0,n.Z)(s.AW,{path:"/soapbox/admin/reports",exact:!0,component:J}),(0,n.Z)(s.AW,{path:"/soapbox/admin/approval",exact:!0,component:x}))):null}}}]);
//# sourceMappingURL=admin-e75f76af003a3ce865b2.chunk.js.map