{"version":3,"file":"packs/js/features/account_gallery-9ce77b634aea601aac6b.chunk.js","mappings":"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","sources":["webpack://soapbox-fe/./app/soapbox/features/account_gallery/components/media_item.js","webpack://soapbox-fe/./app/soapbox/features/account_gallery/index.js","webpack://soapbox-fe/./app/soapbox/features/ui/components/profile_media_panel.tsx"],"sourcesContent":["import _extends from\"@babel/runtime/helpers/esm/extends\";import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";var _dec,_class,_class2;import\"core-js/modules/web.dom-collections.iterator.js\";import classNames from'classnames';import PropTypes from'prop-types';import React from'react';import ImmutablePropTypes from'react-immutable-proptypes';import ImmutablePureComponent from'react-immutable-pure-component';import{connect}from'react-redux';import{getSettings}from'soapbox/actions/settings';import Blurhash from'soapbox/components/blurhash';import Icon from'soapbox/components/icon';import StillImage from'soapbox/components/still_image';import{isIOS}from'soapbox/is_mobile';const mapStateToProps=state=>({autoPlayGif:getSettings(state).get('autoPlayGif'),displayMedia:getSettings(state).get('displayMedia')});let MediaItem=(_dec=connect(mapStateToProps),_dec(_class=(_class2=class MediaItem extends ImmutablePureComponent{constructor(){super(...arguments);_defineProperty(this,\"state\",{visible:this.props.displayMedia!=='hide_all'&&!this.props.attachment.getIn(['status','sensitive'])||this.props.displayMedia==='show_all',loaded:false});_defineProperty(this,\"handleImageLoad\",()=>{this.setState({loaded:true});});_defineProperty(this,\"handleMouseEnter\",e=>{if(this.hoverToPlay()){e.target.play();}});_defineProperty(this,\"handleMouseLeave\",e=>{if(this.hoverToPlay()){e.target.pause();e.target.currentTime=0;}});_defineProperty(this,\"hoverToPlay\",()=>{const{autoPlayGif}=this.props;return!autoPlayGif&&['gifv','video'].indexOf(this.props.attachment.get('type'))!==-1;});_defineProperty(this,\"handleClick\",e=>{if(e.button===0&&!(e.ctrlKey||e.metaKey)){e.preventDefault();if(this.state.visible){this.props.onOpenMedia(this.props.attachment);}else{this.setState({visible:true});}}});}render(){const{attachment,displayWidth,autoPlayGif}=this.props;const{visible,loaded}=this.state;const width=\"\".concat(Math.floor((displayWidth-4)/3)-4,\"px\");const height=width;const status=attachment.get('status');const title=status.get('spoiler_text')||attachment.get('description');let thumbnail='';let icon;if(attachment.get('type')==='unknown'){// Skip\n}else if(attachment.get('type')==='image'){const focusX=attachment.getIn(['meta','focus','x'])||0;const focusY=attachment.getIn(['meta','focus','y'])||0;const x=(focusX/2+.5)*100;const y=(focusY/-2+.5)*100;thumbnail=/*#__PURE__*/_jsx(StillImage,{src:attachment.get('preview_url'),alt:attachment.get('description'),style:{objectPosition:\"\".concat(x,\"% \").concat(y,\"%\")}});}else if(['gifv','video'].indexOf(attachment.get('type'))!==-1){const conditionalAttributes={};if(isIOS()){conditionalAttributes.playsInline='1';}if(autoPlayGif){conditionalAttributes.autoPlay='1';}thumbnail=/*#__PURE__*/_jsx(\"div\",{className:classNames('media-gallery__gifv',{autoplay:autoPlayGif})},void 0,/*#__PURE__*/React.createElement(\"video\",_extends({className:\"media-gallery__item-gifv-thumbnail\",\"aria-label\":attachment.get('description'),title:attachment.get('description'),role:\"application\",src:attachment.get('url'),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,loop:true,muted:true},conditionalAttributes)),/*#__PURE__*/_jsx(\"span\",{className:\"media-gallery__gifv__label\"},void 0,\"GIF\"));}else if(attachment.get('type')==='audio'){const remoteURL=attachment.get('remote_url')||'';const fileExtensionLastIndex=remoteURL.lastIndexOf('.');const fileExtension=remoteURL.substr(fileExtensionLastIndex+1).toUpperCase();thumbnail=/*#__PURE__*/_jsx(\"div\",{className:\"media-gallery__item-thumbnail\"},void 0,/*#__PURE__*/_jsx(\"span\",{className:\"media-gallery__item__icons\"},void 0,/*#__PURE__*/_jsx(Icon,{id:\"volume-up\"})),/*#__PURE__*/_jsx(\"span\",{className:\"media-gallery__file-extension__label\"},void 0,fileExtension));}if(!visible){icon=/*#__PURE__*/_jsx(\"span\",{className:\"account-gallery__item__icons\"},void 0,/*#__PURE__*/_jsx(Icon,{id:\"eye-slash\"}));}return/*#__PURE__*/_jsx(\"div\",{className:\"account-gallery__item\",style:{width,height}},void 0,/*#__PURE__*/_jsx(\"a\",{className:\"media-gallery__item-thumbnail\",href:status.get('url'),target:\"_blank\",onClick:this.handleClick,title:title},void 0,/*#__PURE__*/_jsx(Blurhash,{hash:attachment.get('blurhash'),className:classNames('media-gallery__preview',{'media-gallery__preview--hidden':visible&&loaded})}),visible&&thumbnail,!visible&&icon));}},_defineProperty(_class2,\"propTypes\",{attachment:ImmutablePropTypes.map.isRequired,displayWidth:PropTypes.number.isRequired,onOpenMedia:PropTypes.func.isRequired,autoPlayGif:PropTypes.bool,displayMedia:PropTypes.string}),_class2))||_class);export{MediaItem as default};","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";var _dec,_class,_class2;import\"core-js/modules/web.dom-collections.iterator.js\";import PropTypes from'prop-types';import React from'react';import ImmutablePropTypes from'react-immutable-proptypes';import ImmutablePureComponent from'react-immutable-pure-component';import{FormattedMessage}from'react-intl';import{connect}from'react-redux';import{fetchAccount,fetchAccountByUsername}from'soapbox/actions/accounts';import{openModal}from'soapbox/actions/modals';import LoadMore from'soapbox/components/load_more';import MissingIndicator from'soapbox/components/missing_indicator';import{Column}from'soapbox/components/ui';import{Spinner}from'soapbox/components/ui';import{getAccountGallery,findAccountByUsername}from'soapbox/selectors';import{getFeatures}from'soapbox/utils/features';import{expandAccountMediaTimeline}from'../../actions/timelines';import MediaItem from'./components/media_item';const mapStateToProps=(state,_ref)=>{let{params,withReplies=false}=_ref;const username=params.username||'';const me=state.get('me');const accountFetchError=(state.getIn(['accounts',-1,'username'])||'').toLowerCase()===username.toLowerCase();const features=getFeatures(state.get('instance'));let accountId=-1;let accountUsername=username;if(accountFetchError){accountId=null;}else{const account=findAccountByUsername(state,username);accountId=account?account.getIn(['id'],null):-1;accountUsername=account?account.getIn(['acct'],''):'';}const isBlocked=state.getIn(['relationships',accountId,'blocked_by'],false);const unavailable=me===accountId?false:isBlocked&&!features.blockersVisible;return{accountId,unavailable,accountUsername,isAccount:!!state.getIn(['accounts',accountId]),attachments:getAccountGallery(state,accountId),isLoading:state.getIn(['timelines',\"account:\".concat(accountId,\":media\"),'isLoading']),hasMore:state.getIn(['timelines',\"account:\".concat(accountId,\":media\"),'hasMore'])};};class LoadMoreMedia extends ImmutablePureComponent{constructor(){super(...arguments);_defineProperty(this,\"handleLoadMore\",()=>{this.props.onLoadMore(this.props.maxId);});}render(){return/*#__PURE__*/_jsx(LoadMore,{disabled:this.props.disabled,onClick:this.handleLoadMore});}}_defineProperty(LoadMoreMedia,\"propTypes\",{maxId:PropTypes.string,onLoadMore:PropTypes.func.isRequired});let AccountGallery=(_dec=connect(mapStateToProps),_dec(_class=(_class2=class AccountGallery extends ImmutablePureComponent{constructor(){super(...arguments);_defineProperty(this,\"state\",{width:323});_defineProperty(this,\"handleScrollToBottom\",()=>{if(this.props.hasMore){this.handleLoadMore(this.props.attachments.size>0?this.props.attachments.last().getIn(['status','id']):undefined);}});_defineProperty(this,\"handleScroll\",e=>{const{scrollTop,scrollHeight,clientHeight}=e.target;const offset=scrollHeight-scrollTop-clientHeight;if(150>offset&&!this.props.isLoading){this.handleScrollToBottom();}});_defineProperty(this,\"handleLoadMore\",maxId=>{if(this.props.accountId&&this.props.accountId!==-1){this.props.dispatch(expandAccountMediaTimeline(this.props.accountId,{maxId}));}});_defineProperty(this,\"handleLoadOlder\",e=>{e.preventDefault();this.handleScrollToBottom();});_defineProperty(this,\"handleOpenMedia\",attachment=>{if(attachment.get('type')==='video'){this.props.dispatch(openModal('VIDEO',{media:attachment,status:attachment.get('status'),account:attachment.get('account')}));}else{const media=attachment.getIn(['status','media_attachments']);const index=media.findIndex(x=>x.get('id')===attachment.get('id'));this.props.dispatch(openModal('MEDIA',{media,index,status:attachment.get('status'),account:attachment.get('account')}));}});_defineProperty(this,\"handleRef\",c=>{if(c){this.setState({width:c.offsetWidth});}});}componentDidMount(){const{params:{username},accountId}=this.props;if(accountId&&accountId!==-1){this.props.dispatch(fetchAccount(accountId));this.props.dispatch(expandAccountMediaTimeline(accountId));}else{this.props.dispatch(fetchAccountByUsername(username));}}componentDidUpdate(prevProps){const{accountId,params}=this.props;if(accountId&&accountId!==-1&&accountId!==prevProps.accountId&&accountId){this.props.dispatch(fetchAccount(params.accountId));this.props.dispatch(expandAccountMediaTimeline(accountId));}}render(){const{attachments,isLoading,hasMore,isAccount,accountId,unavailable,accountUsername}=this.props;const{width}=this.state;if(!isAccount&&accountId!==-1){return/*#__PURE__*/_jsx(MissingIndicator,{});}if(accountId===-1||!attachments&&isLoading){return/*#__PURE__*/_jsx(Column,{},void 0,/*#__PURE__*/_jsx(Spinner,{}));}let loadOlder=null;if(hasMore&&!(isLoading&&attachments.size===0)){loadOlder=/*#__PURE__*/_jsx(LoadMore,{visible:!isLoading,onClick:this.handleLoadOlder});}if(unavailable){return/*#__PURE__*/_jsx(Column,{},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"empty-column-indicator\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"empty_column.account_unavailable\",defaultMessage:\"Profile unavailable\"})));}return/*#__PURE__*/_jsx(Column,{label:\"@\".concat(accountUsername),transparent:true,withHeader:false},void 0,/*#__PURE__*/React.createElement(\"div\",{role:\"feed\",className:\"account-gallery__container\",ref:this.handleRef},attachments.map((attachment,index)=>attachment===null?/*#__PURE__*/_jsx(LoadMoreMedia,{maxId:index>0?attachments.getIn(index-1,'id'):null,onLoadMore:this.handleLoadMore},'more:'+attachments.getIn(index+1,'id')):/*#__PURE__*/_jsx(MediaItem,{attachment:attachment,displayWidth:width,onOpenMedia:this.handleOpenMedia},\"\".concat(attachment.getIn(['status','id']),\"+\").concat(attachment.get('id')))),attachments.size===0&&/*#__PURE__*/_jsx(\"div\",{className:\"empty-column-indicator\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"account_gallery.none\",defaultMessage:\"No media to show.\"})),loadOlder),isLoading&&attachments.size===0&&/*#__PURE__*/_jsx(\"div\",{className:\"slist__append\"},void 0,/*#__PURE__*/_jsx(Spinner,{})));}},_defineProperty(_class2,\"propTypes\",{params:PropTypes.object.isRequired,dispatch:PropTypes.func.isRequired,attachments:ImmutablePropTypes.list.isRequired,isLoading:PropTypes.bool,hasMore:PropTypes.bool,isAccount:PropTypes.bool,unavailable:PropTypes.bool}),_class2))||_class);export{AccountGallery as default};","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import\"core-js/modules/web.dom-collections.iterator.js\";import{List as ImmutableList}from'immutable';import React,{useState,useEffect}from'react';import{FormattedMessage}from'react-intl';import{useDispatch}from'react-redux';import{openModal}from'soapbox/actions/modals';import{Spinner,Widget}from'soapbox/components/ui';import{useAppSelector}from'soapbox/hooks';import{getAccountGallery}from'soapbox/selectors';import{expandAccountMediaTimeline}from'../../../actions/timelines';import MediaItem from'../../account_gallery/components/media_item';const ProfileMediaPanel=_ref=>{let{account}=_ref;const dispatch=useDispatch();const[loading,setLoading]=useState(true);const attachments=useAppSelector(state=>account?getAccountGallery(state,account===null||account===void 0?void 0:account.id):ImmutableList());const handleOpenMedia=attachment=>{if(attachment.type==='video'){dispatch(openModal('VIDEO',{media:attachment,status:attachment.status}));}else{const media=attachment.getIn(['status','media_attachments']);const index=media.findIndex(x=>x.id===attachment.id);dispatch(openModal('MEDIA',{media,index,status:attachment.status,account:attachment.account}));}};useEffect(()=>{setLoading(true);if(account){dispatch(expandAccountMediaTimeline(account.id))// @ts-ignore yes it does\n.then(()=>setLoading(false)).catch(()=>{});}},[account===null||account===void 0?void 0:account.id]);const renderAttachments=()=>{const publicAttachments=attachments.filter(attachment=>attachment.getIn(['status','visibility'])==='public');const nineAttachments=publicAttachments.slice(0,9);if(!nineAttachments.isEmpty()){return/*#__PURE__*/_jsx(\"div\",{className:\"media-panel__list\"},void 0,nineAttachments.map((attachment,_index)=>/*#__PURE__*/_jsx(MediaItem,{attachment:attachment,displayWidth:255,onOpenMedia:handleOpenMedia},\"\".concat(attachment.getIn(['status','id']),\"+\").concat(attachment.id))));}else{return/*#__PURE__*/_jsx(\"div\",{className:\"media-panel__empty\"},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"media_panel.empty_message\",defaultMessage:\"No media found.\"}));}};return/*#__PURE__*/_jsx(Widget,{title:/*#__PURE__*/_jsx(FormattedMessage,{id:\"media_panel.title\",defaultMessage:\"Media\"})},void 0,account&&/*#__PURE__*/_jsx(\"div\",{className:\"media-panel__content\"},void 0,loading?/*#__PURE__*/_jsx(Spinner,{}):renderAttachments()));};export default ProfileMediaPanel;"],"names":["_class","_class2","MediaItem","state","autoPlayGif","get","displayMedia","_dec","arguments","visible","props","attachment","getIn","loaded","setState","e","hoverToPlay","target","play","pause","currentTime","indexOf","button","ctrlKey","metaKey","preventDefault","onOpenMedia","render","icon","this","displayWidth","width","concat","Math","floor","height","status","title","thumbnail","x","y","src","alt","style","objectPosition","conditionalAttributes","playsInline","autoPlay","className","autoplay","role","onMouseEnter","handleMouseEnter","onMouseLeave","handleMouseLeave","loop","muted","remoteURL","fileExtensionLastIndex","lastIndexOf","fileExtension","substr","toUpperCase","id","href","onClick","handleClick","hash","onLoadMore","maxId","disabled","handleLoadMore","LoadMoreMedia","AccountGallery","_ref","params","username","me","accountFetchError","toLowerCase","features","accountId","accountUsername","account","isBlocked","unavailable","blockersVisible","isAccount","attachments","isLoading","hasMore","size","last","undefined","scrollTop","handleScrollToBottom","dispatch","media","index","findIndex","c","offsetWidth","componentDidMount","componentDidUpdate","prevProps","loadOlder","handleLoadOlder","defaultMessage","label","transparent","withHeader","ref","handleRef","map","handleOpenMedia","nineAttachments","useState","loading","setLoading","type","useEffect","then","catch","filter","slice","isEmpty","_index"],"sourceRoot":""}