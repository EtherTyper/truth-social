"use strict";(self.webpackChunksoapbox_fe=self.webpackChunksoapbox_fe||[]).push([[7],{546:function(e,t,a){a.d(t,{Z:function(){return w}});var n,i,o,s=a(1810),r=a(1821),l=a(1814),c=(a(1),a(6)),d=a.n(c),u=a(5),p=a.n(u),h=a(0),f=a(10),m=a.n(f),g=a(8),v=a(3),y=a(12),_=a(298),Z=a(15),b=a(154),I=a(57),M=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),w=(0,v.$j)((function(e){return{autoPlayGif:(0,y.Gw)(e).get("autoPlayGif"),displayMedia:(0,y.Gw)(e).get("displayMedia")}}))((o=function(e){function t(){var t=e.apply(this,arguments)||this;return(0,l.Z)(t,"state",{visible:"hide_all"!==t.props.displayMedia&&!t.props.attachment.getIn(["status","sensitive"])||"show_all"===t.props.displayMedia,loaded:!1}),(0,l.Z)(t,"handleImageLoad",(function(){t.setState({loaded:!0})})),(0,l.Z)(t,"handleMouseEnter",(function(e){t.hoverToPlay()&&e.target.play()})),(0,l.Z)(t,"handleMouseLeave",(function(e){t.hoverToPlay()&&(e.target.pause(),e.target.currentTime=0)})),(0,l.Z)(t,"hoverToPlay",(function(){return!t.props.autoPlayGif&&-1!==["gifv","video"].indexOf(t.props.attachment.get("type"))})),(0,l.Z)(t,"handleClick",(function(e){0!==e.button||e.ctrlKey||e.metaKey||(e.preventDefault(),t.state.visible?t.props.onOpenMedia(t.props.attachment):t.setState({visible:!0}))})),t}return M(t,e),t.prototype.render=function(){var e,t=this.props,a=t.attachment,n=t.displayWidth,i=t.autoPlayGif,o=this.state,l=o.visible,c=o.loaded,u="".concat(Math.floor((n-4)/3)-4,"px"),p=u,f=a.get("status"),m=f.get("spoiler_text")||a.get("description"),g="";if("unknown"===a.get("type"));else if("image"===a.get("type")){var v=100*((a.getIn(["meta","focus","x"])||0)/2+.5),y=100*((a.getIn(["meta","focus","y"])||0)/-2+.5);g=(0,r.Z)(b.Z,{src:a.get("preview_url"),alt:a.get("description"),style:{objectPosition:"".concat(v,"% ").concat(y,"%")}})}else if(-1!==["gifv","video"].indexOf(a.get("type"))){var M={};(0,I.gn)()&&(M.playsInline="1"),i&&(M.autoPlay="1"),g=(0,r.Z)("div",{className:d()("media-gallery__gifv",{autoplay:i})},void 0,h.createElement("video",(0,s.Z)({className:"media-gallery__item-gifv-thumbnail","aria-label":a.get("description"),title:a.get("description"),role:"application",src:a.get("url"),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,loop:!0,muted:!0},M)),(0,r.Z)("span",{className:"media-gallery__gifv__label"},void 0,"GIF"))}else if("audio"===a.get("type")){var w=a.get("remote_url")||"",L=w.lastIndexOf("."),O=w.substr(L+1).toUpperCase();g=(0,r.Z)("div",{className:"media-gallery__item-thumbnail"},void 0,(0,r.Z)("span",{className:"media-gallery__item__icons"},void 0,(0,r.Z)(Z.Z,{id:"volume-up"})),(0,r.Z)("span",{className:"media-gallery__file-extension__label"},void 0,O))}return l||(e=(0,r.Z)("span",{className:"account-gallery__item__icons"},void 0,(0,r.Z)(Z.Z,{id:"eye-slash"}))),(0,r.Z)("div",{className:"account-gallery__item",style:{width:u,height:p}},void 0,(0,r.Z)("a",{className:"media-gallery__item-thumbnail",href:f.get("url"),target:"_blank",onClick:this.handleClick,title:m},void 0,(0,r.Z)(_.Z,{hash:a.get("blurhash"),className:d()("media-gallery__preview",{"media-gallery__preview--hidden":l&&c})}),l&&g,!l&&e))},t}(g.ZP),(0,l.Z)(o,"propTypes",{attachment:m().map.isRequired,displayWidth:p().number.isRequired,onOpenMedia:p().func.isRequired,autoPlayGif:p().bool,displayMedia:p().string}),i=o))||i},1042:function(e,t,a){a.r(t),a.d(t,{default:function(){return N}});var n,i,o,s=a(1821),r=a(1814),l=(a(1),a(5)),c=a.n(l),d=a(0),u=a(10),p=a.n(u),h=a(8),f=a(1827),m=a(3),g=a(16),v=a(1828),y=a(483),_=a(76),Z=a(2),b=a(11),I=a(14),M=a(28),w=a(546),L=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),O=function(e){function t(){var t=e.apply(this,arguments)||this;return(0,r.Z)(t,"handleLoadMore",(function(){t.props.onLoadMore(t.props.maxId)})),t}return L(t,e),t.prototype.render=function(){return(0,s.Z)(y.Z,{disabled:this.props.disabled,onClick:this.handleLoadMore})},t}(h.ZP);(0,r.Z)(O,"propTypes",{maxId:c().string,onLoadMore:c().func.isRequired});var N=(0,m.$j)((function(e,t){var a=t.params,n=(t.withReplies,a.username||""),i=e.get("me"),o=(e.getIn(["accounts",-1,"username"])||"").toLowerCase()===n.toLowerCase(),s=(0,I.N$)(e.get("instance")),r=-1,l=n;if(o)r=null;else{var c=(0,b.XO)(e,n);r=c?c.getIn(["id"],null):-1,l=c?c.getIn(["acct"],""):""}var d=e.getIn(["relationships",r,"blocked_by"],!1);return{accountId:r,unavailable:i!==r&&d&&!s.blockersVisible,accountUsername:l,isAccount:!!e.getIn(["accounts",r]),attachments:(0,b.Uq)(e,r),isLoading:e.getIn(["timelines","account:".concat(r,":media"),"isLoading"]),hasMore:e.getIn(["timelines","account:".concat(r,":media"),"hasMore"])}}))((o=function(e){function t(){var t=e.apply(this,arguments)||this;return(0,r.Z)(t,"state",{width:323}),(0,r.Z)(t,"handleScrollToBottom",(function(){t.props.hasMore&&t.handleLoadMore(t.props.attachments.size>0?t.props.attachments.last().getIn(["status","id"]):void 0)})),(0,r.Z)(t,"handleScroll",(function(e){var a=e.target,n=a.scrollTop;150>a.scrollHeight-n-a.clientHeight&&!t.props.isLoading&&t.handleScrollToBottom()})),(0,r.Z)(t,"handleLoadMore",(function(e){t.props.accountId&&-1!==t.props.accountId&&t.props.dispatch((0,M.fe)(t.props.accountId,{maxId:e}))})),(0,r.Z)(t,"handleLoadOlder",(function(e){e.preventDefault(),t.handleScrollToBottom()})),(0,r.Z)(t,"handleOpenMedia",(function(e){if("video"===e.get("type"))t.props.dispatch((0,v.h7)("VIDEO",{media:e,status:e.get("status"),account:e.get("account")}));else{var a=e.getIn(["status","media_attachments"]),n=a.findIndex((function(t){return t.get("id")===e.get("id")}));t.props.dispatch((0,v.h7)("MEDIA",{media:a,index:n,status:e.get("status"),account:e.get("account")}))}})),(0,r.Z)(t,"handleRef",(function(e){e&&t.setState({width:e.offsetWidth})})),t}return L(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.params.username,a=e.accountId;a&&-1!==a?(this.props.dispatch((0,g.$G)(a)),this.props.dispatch((0,M.fe)(a))):this.props.dispatch((0,g.UL)(t))},t.prototype.componentDidUpdate=function(e){var t=this.props,a=t.accountId,n=t.params;a&&-1!==a&&a!==e.accountId&&a&&(this.props.dispatch((0,g.$G)(n.accountId)),this.props.dispatch((0,M.fe)(a)))},t.prototype.render=function(){var e=this,t=this.props,a=t.attachments,n=t.isLoading,i=t.hasMore,o=t.isAccount,r=t.accountId,l=t.unavailable,c=t.accountUsername,u=this.state.width;if(!o&&-1!==r)return(0,s.Z)(_.Z,{});if(-1===r||!a&&n)return(0,s.Z)(Z.sg,{},void 0,(0,s.Z)(Z.$j,{}));var p=null;return!i||n&&0===a.size||(p=(0,s.Z)(y.Z,{visible:!n,onClick:this.handleLoadOlder})),l?(0,s.Z)(Z.sg,{},void 0,(0,s.Z)("div",{className:"empty-column-indicator"},void 0,(0,s.Z)(f.Z,{id:"empty_column.account_unavailable",defaultMessage:"Profile unavailable"}))):(0,s.Z)(Z.sg,{label:"@".concat(c),transparent:!0,withHeader:!1},void 0,d.createElement("div",{role:"feed",className:"account-gallery__container",ref:this.handleRef},a.map((function(t,n){return null===t?(0,s.Z)(O,{maxId:n>0?a.getIn(n-1,"id"):null,onLoadMore:e.handleLoadMore},"more:"+a.getIn(n+1,"id")):(0,s.Z)(w.Z,{attachment:t,displayWidth:u,onOpenMedia:e.handleOpenMedia},"".concat(t.getIn(["status","id"]),"+").concat(t.get("id")))})),0===a.size&&(0,s.Z)("div",{className:"empty-column-indicator"},void 0,(0,s.Z)(f.Z,{id:"account_gallery.none",defaultMessage:"No media to show."})),p),n&&0===a.size&&(0,s.Z)("div",{className:"slist__append"},void 0,(0,s.Z)(Z.$j,{})))},t}(h.ZP),(0,r.Z)(o,"propTypes",{params:c().object.isRequired,dispatch:c().func.isRequired,attachments:p().list.isRequired,isLoading:c().bool,hasMore:c().bool,isAccount:c().bool,unavailable:c().bool}),i=o))||i},1101:function(e,t,a){a.r(t);var n=a(1821),i=(a(1),a(602)),o=a(0),s=a(1827),r=a(3),l=a(1828),c=a(2),d=a(4),u=a(11),p=a(28),h=a(546);t.default=function(e){var t,a=e.account,f=(0,r.I0)(),m=(0,o.useState)(!0),g=m[0],v=m[1],y=(0,d.CG)((function(e){return a?(0,u.Uq)(e,null==a?void 0:a.id):(0,i.List)()})),_=function(e){if("video"===e.type)f((0,l.h7)("VIDEO",{media:e,status:e.status}));else{var t=e.getIn(["status","media_attachments"]),a=t.findIndex((function(t){return t.id===e.id}));f((0,l.h7)("MEDIA",{media:t,index:a,status:e.status,account:e.account}))}};return(0,o.useEffect)((function(){v(!0),a&&f((0,p.fe)(a.id)).then((function(){return v(!1)})).catch((function(){}))}),[null==a?void 0:a.id]),(0,n.Z)(c.$L,{title:(0,n.Z)(s.Z,{id:"media_panel.title",defaultMessage:"Media"})},void 0,a&&(0,n.Z)("div",{className:"media-panel__content"},void 0,g?(0,n.Z)(c.$j,{}):(t=y.filter((function(e){return"public"===e.getIn(["status","visibility"])})).slice(0,9)).isEmpty()?(0,n.Z)("div",{className:"media-panel__empty"},void 0,(0,n.Z)(s.Z,{id:"media_panel.empty_message",defaultMessage:"No media found."})):(0,n.Z)("div",{className:"media-panel__list"},void 0,t.map((function(e,t){return(0,n.Z)(h.Z,{attachment:e,displayWidth:255,onOpenMedia:_},"".concat(e.getIn(["status","id"]),"+").concat(e.id))})))))}}}]);
//# sourceMappingURL=account_gallery-9ce77b634aea601aac6b.chunk.js.map