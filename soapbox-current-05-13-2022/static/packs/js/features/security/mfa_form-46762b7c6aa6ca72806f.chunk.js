"use strict";(self.webpackChunksoapbox_fe=self.webpackChunksoapbox_fe||[]).push([[63],{1088:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var s=a(1821),o=(a(1),a(0)),r=a(1815),i=a(583),n=a(4),d=a(199),c=a(2),u=(a(165),a(1827)),l=a(1811),f=a(17),m=(0,r.vU)({mfa_setup_disable_button:{id:"column.mfa_disable_button",defaultMessage:"Disable"},disableFail:{id:"security.disable.fail",defaultMessage:"Incorrect password. Try again."},mfaDisableSuccess:{id:"mfa.disable.success_message",defaultMessage:"MFA disabled"},passwordPlaceholder:{id:"mfa.mfa_setup.password_placeholder",defaultMessage:"Password"}}),p=function(){var e=(0,o.useState)(!1),t=e[0],a=e[1],r=(0,o.useState)(""),p=r[0],g=r[1],h=(0,i.Z)(),Z=(0,n.TL)(),v=(0,l.k6)(),b=(0,o.useCallback)((function(){a(!0),Z((0,d.B2)("totp",p)).then((function(){Z(f.ZP.success(h.formatMessage(m.mfaDisableSuccess))),v.push("../auth/edit")})).finally((function(){a(!1)})).catch((function(){Z(f.ZP.error(h.formatMessage(m.disableFail)))}))}),[p,Z,h]);return(0,s.Z)(c.l0,{onSubmit:b},void 0,(0,s.Z)(c.Kq,{},void 0,(0,s.Z)(c.xv,{weight:"medium"},void 0,(0,s.Z)(u.Z,{id:"mfa.otp_enabled_title",defaultMessage:"OTP Enabled"})),(0,s.Z)(c.xv,{theme:"muted"},void 0,(0,s.Z)(u.Z,{id:"mfa.otp_enabled_description",defaultMessage:"You have enabled two-factor authentication via OTP."}))),(0,s.Z)(c.cw,{labelText:h.formatMessage(m.passwordPlaceholder),hintText:(0,s.Z)(u.Z,{id:"mfa.mfa_disable_enter_password",defaultMessage:"Enter your current password to disable two-factor auth."})},void 0,(0,s.Z)(c.II,{type:"password",placeholder:h.formatMessage(m.passwordPlaceholder),name:"password",onChange:function(e){g(e.target.value)},disabled:t,value:p,required:!0})),(0,s.Z)(c.iN,{},void 0,(0,s.Z)(c.zx,{disabled:t,theme:"danger",type:"submit",text:h.formatMessage(m.mfa_setup_disable_button)})))},g=(0,r.vU)({mfaCancelButton:{id:"column.mfa_cancel",defaultMessage:"Cancel"},mfaSetupButton:{id:"column.mfa_setup",defaultMessage:"Proceed to Setup"},codesFail:{id:"security.codes.fail",defaultMessage:"Failed to fetch backup codes"}}),h=function(e){var t=e.displayOtpForm,a=e.handleSetupProceedClick,r=(0,n.TL)(),m=(0,i.Z)(),p=(0,l.k6)(),h=(0,o.useState)([]),Z=h[0],v=h[1];return(0,o.useEffect)((function(){r((0,d.uD)()).then((function(e){var t=e.codes;v(t)})).catch((function(){r(f.ZP.error(m.formatMessage(g.codesFail)))}))}),[]),(0,s.Z)(c.Kq,{space:4},void 0,(0,s.Z)(c.Kq,{space:2},void 0,(0,s.Z)(c.xv,{theme:"muted"},void 0,(0,s.Z)(u.Z,{id:"mfa.setup_warning",defaultMessage:"Write these codes down or save them somewhere secure - otherwise you won't see them again. If you lose access to your 2FA app and recovery codes you'll be locked out of your account."})),(0,s.Z)("div",{className:"bg-gray-100 dark:bg-slate-900/50 rounded-lg p-4"},void 0,(0,s.Z)(c.Kq,{space:3},void 0,(0,s.Z)(c.xv,{weight:"medium",align:"center"},void 0,(0,s.Z)(u.Z,{id:"mfa.setup_recoverycodes",defaultMessage:"Recovery codes"})),Z.length>0?(0,s.Z)("div",{className:"grid gap-3 grid-cols-2 rounded-lg text-center"},void 0,Z.map((function(e,t){return(0,s.Z)(c.xv,{theme:"muted",size:"sm"},t,e)}))):(0,s.Z)(c.$j,{})))),!t&&(0,s.Z)(c.iN,{},void 0,(0,s.Z)(c.zx,{theme:"ghost",text:m.formatMessage(g.mfaCancelButton),onClick:function(){return p.push("../auth/edit")}}),Z.length>0&&(0,s.Z)(c.zx,{theme:"primary",text:m.formatMessage(g.mfaSetupButton),onClick:a})))},Z=a(1814),v=a(629),b=a.n(v);function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){(0,Z.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var M=(0,r.vU)({mfaCancelButton:{id:"column.mfa_cancel",defaultMessage:"Cancel"},mfaSetupConfirmButton:{id:"column.mfa_confirm_button",defaultMessage:"Confirm"},confirmFail:{id:"security.confirm.fail",defaultMessage:"Incorrect code or password. Try again."},qrFail:{id:"security.qr.fail",defaultMessage:"Failed to fetch setup key"},mfaConfirmSuccess:{id:"mfa.confirm.success_message",defaultMessage:"MFA confirmed"},codePlaceholder:{id:"mfa.mfa_setup.code_placeholder",defaultMessage:"Code"},passwordPlaceholder:{id:"mfa.mfa_setup.password_placeholder",defaultMessage:"Password"}}),_=function(){var e=(0,i.Z)(),t=(0,l.k6)(),a=(0,n.TL)(),r=(0,o.useState)({password:"",isLoading:!1,code:"",qrCodeURI:"",confirmKey:""}),m=r[0],p=r[1];(0,o.useEffect)((function(){a((0,d.oJ)("totp")).then((function(e){p((function(t){return w(w({},t),{},{qrCodeURI:e.provisioning_uri,confirmKey:e.key})}))})).catch((function(){a(f.ZP.error(e.formatMessage(M.qrFail)))}))}),[]);var g=(0,o.useCallback)((function(e){e.persist(),p((function(t){var a;return w(w({},t),{},((a={})[e.target.name]=e.target.value,a))}))}),[]);return(0,s.Z)(c.Kq,{space:4},void 0,(0,s.Z)("hr",{className:"mt-4 dark:border-slate-700"}),(0,s.Z)(c.l0,{onSubmit:function(s){p((function(e){return w(w({},e),{},{isLoading:!0})})),a((0,d.iO)("totp",m.code,m.password)).then((function(s){a(f.ZP.success(e.formatMessage(M.mfaConfirmSuccess))),t.push("../auth/edit")})).catch((function(){a(f.ZP.error(e.formatMessage(M.confirmFail))),p((function(e){return w(w({},e),{},{isLoading:!1})}))})),s.preventDefault()}},void 0,(0,s.Z)(c.Kq,{},void 0,(0,s.Z)(c.xv,{weight:"semibold",size:"lg"},void 0,"1. ",(0,s.Z)(u.Z,{id:"mfa.mfa_setup_scan_title",defaultMessage:"Scan"})),(0,s.Z)(c.xv,{theme:"muted"},void 0,(0,s.Z)(u.Z,{id:"mfa.mfa_setup_scan_description",defaultMessage:"Using your two-factor app, scan this QR code or enter the text key."}))),(0,s.Z)(b(),{value:m.qrCodeURI}),m.confirmKey,(0,s.Z)(c.xv,{weight:"semibold",size:"lg"},void 0,"2. ",(0,s.Z)(u.Z,{id:"mfa.mfa_setup_verify_title",defaultMessage:"Verify"})),(0,s.Z)(c.cw,{labelText:e.formatMessage(M.codePlaceholder),hintText:(0,s.Z)(u.Z,{id:"mfa.mfa_setup.code_hint",defaultMessage:"Enter the code from your two-factor app."})},void 0,(0,s.Z)(c.II,{name:"code",placeholder:e.formatMessage(M.codePlaceholder),onChange:g,autoComplete:"off",disabled:m.isLoading,value:m.code,type:"text",required:!0})),(0,s.Z)(c.cw,{labelText:e.formatMessage(M.passwordPlaceholder),hintText:(0,s.Z)(u.Z,{id:"mfa.mfa_setup.password_hint",defaultMessage:"Enter your current password to confirm your identity."})},void 0,(0,s.Z)(c.II,{type:"password",name:"password",placeholder:e.formatMessage(M.passwordPlaceholder),onChange:g,disabled:m.isLoading,value:m.password,required:!0})),(0,s.Z)(c.iN,{},void 0,(0,s.Z)(c.zx,{type:"button",theme:"ghost",text:e.formatMessage(M.mfaCancelButton),onClick:function(){return t.push("../auth/edit")},disabled:m.isLoading}),(0,s.Z)(c.zx,{type:"submit",theme:"primary",text:e.formatMessage(M.mfaSetupConfirmButton),disabled:m.isLoading}))))},P=(0,r.vU)({heading:{id:"column.mfa",defaultMessage:"Multi-Factor Authentication"}}),x=function(){var e=(0,i.Z)(),t=(0,n.TL)(),a=(0,o.useState)(!1),r=a[0],u=a[1];(0,o.useEffect)((function(){t((0,d.PD)())}),[]);var l=(0,n.CG)((function(e){return e.security.get("mfa")}));return(0,s.Z)(c.sg,{label:e.formatMessage(P.heading),transparent:!0,withHeader:!1},void 0,(0,s.Z)(c.Zb,{variant:"rounded"},void 0,(0,s.Z)(c.Ol,{backHref:"/settings"},void 0,(0,s.Z)(c.ll,{title:e.formatMessage(P.heading)})),(0,s.Z)(c.eW,{},void 0,l.getIn(["settings","totp"])?(0,s.Z)(p,{}):o.createElement(o.Fragment,null,(0,s.Z)(h,{displayOtpForm:r,handleSetupProceedClick:function(e){e.preventDefault(),u(!0)}}),r&&(0,s.Z)(_,{})))))}}}]);
//# sourceMappingURL=mfa_form-46762b7c6aa6ca72806f.chunk.js.map