{"version":3,"file":"packs/js/features/chats/components/chat_panes-8ddddc0e67d90b53a5c0.chunk.js","mappings":"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","sources":["webpack://soapbox-fe/./app/soapbox/features/chats/components/chat_window.js","webpack://soapbox-fe/./app/soapbox/features/chats/components/chat_panes.js"],"sourcesContent":["import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";var _dec,_class,_class2;import\"core-js/modules/web.dom-collections.iterator.js\";import PropTypes from'prop-types';import React from'react';import ImmutablePropTypes from'react-immutable-proptypes';import ImmutablePureComponent from'react-immutable-pure-component';import{injectIntl}from'react-intl';import{connect}from'react-redux';import{Link}from'react-router-dom';import{closeChat,toggleChat}from'soapbox/actions/chats';import Avatar from'soapbox/components/avatar';import HoverRefWrapper from'soapbox/components/hover_ref_wrapper';import IconButton from'soapbox/components/icon_button';import{makeGetChat}from'soapbox/selectors';import{getAcct}from'soapbox/utils/accounts';import{shortNumberFormat}from'soapbox/utils/numbers';import{displayFqn}from'soapbox/utils/state';import ChatBox from'./chat_box';const makeMapStateToProps=()=>{const getChat=makeGetChat();const mapStateToProps=(state,_ref)=>{let{chatId}=_ref;const chat=state.getIn(['chats','items',chatId]);return{me:state.get('me'),chat:chat?getChat(state,chat.toJS()):undefined,displayFqn:displayFqn(state)};};return mapStateToProps;};let ChatWindow=(_dec=connect(makeMapStateToProps),_dec(_class=injectIntl(_class=(_class2=class ChatWindow extends ImmutablePureComponent{constructor(){super(...arguments);_defineProperty(this,\"state\",{content:''});_defineProperty(this,\"handleChatClose\",chatId=>{return e=>{this.props.dispatch(closeChat(chatId));};});_defineProperty(this,\"handleChatToggle\",chatId=>{return e=>{this.props.dispatch(toggleChat(chatId));};});_defineProperty(this,\"handleContentChange\",e=>{this.setState({content:e.target.value});});_defineProperty(this,\"handleInputRef\",el=>{this.inputElem=el;this.focusInput();});_defineProperty(this,\"focusInput\",()=>{if(!this.inputElem)return;this.inputElem.focus();});}componentDidUpdate(prevProps){const oldState=prevProps.windowState;const newState=this.props.windowState;if(oldState!==newState&&newState==='open')this.focusInput();}render(){const{windowState,idx,chat,displayFqn}=this.props;if(!chat)return null;const account=chat.get('account');const right=285*(idx+1)+20;const unreadCount=chat.get('unread');const unreadIcon=/*#__PURE__*/_jsx(\"i\",{className:\"icon-with-badge__badge\"},void 0,shortNumberFormat(unreadCount));const avatar=/*#__PURE__*/_jsx(HoverRefWrapper,{accountId:account.get('id')},void 0,/*#__PURE__*/_jsx(Link,{to:\"/@\".concat(account.get('acct'))},void 0,/*#__PURE__*/_jsx(Avatar,{account:account,size:18})));return/*#__PURE__*/_jsx(\"div\",{className:\"pane pane--\".concat(windowState),style:{right:\"\".concat(right,\"px\")}},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"pane__header\"},void 0,unreadCount>0?unreadIcon:avatar,/*#__PURE__*/_jsx(\"button\",{className:\"pane__title\",onClick:this.handleChatToggle(chat.get('id'))},void 0,\"@\",getAcct(account,displayFqn)),/*#__PURE__*/_jsx(\"div\",{className:\"pane__close\"},void 0,/*#__PURE__*/_jsx(IconButton,{src:require('@tabler/icons/icons/x.svg'),title:\"Close chat\",onClick:this.handleChatClose(chat.get('id'))}))),/*#__PURE__*/_jsx(\"div\",{className:\"pane__content\"},void 0,/*#__PURE__*/_jsx(ChatBox,{chatId:chat.get('id'),onSetInputRef:this.handleInputRef})));}},_defineProperty(_class2,\"propTypes\",{dispatch:PropTypes.func.isRequired,intl:PropTypes.object.isRequired,chatId:PropTypes.string.isRequired,windowState:PropTypes.string.isRequired,idx:PropTypes.number,chat:ImmutablePropTypes.record,me:PropTypes.node,displayFqn:PropTypes.bool}),_class2))||_class)||_class);export{ChatWindow as default};","import _jsx from\"@babel/runtime/helpers/esm/jsx\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";var _dec,_class,_class2;import\"core-js/modules/web.dom-collections.iterator.js\";import{List as ImmutableList}from'immutable';import PropTypes from'prop-types';import React from'react';import ImmutablePropTypes from'react-immutable-proptypes';import ImmutablePureComponent from'react-immutable-pure-component';import{FormattedMessage}from'react-intl';import{injectIntl,defineMessages}from'react-intl';import{connect}from'react-redux';import{withRouter}from'react-router-dom';import{createSelector}from'reselect';import{openChat,launchChat,toggleMainWindow}from'soapbox/actions/chats';import{getSettings}from'soapbox/actions/settings';import AccountSearch from'soapbox/components/account_search';import AudioToggle from'soapbox/features/chats/components/audio_toggle';import{shortNumberFormat}from'soapbox/utils/numbers';import ChatList from'./chat_list';import ChatWindow from'./chat_window';const messages=defineMessages({searchPlaceholder:{\"id\":\"chats.search_placeholder\",\"defaultMessage\":\"Start a chat with\\u2026\"}});const getChatsUnreadCount=state=>{const chats=state.getIn(['chats','items']);return chats.reduce((acc,curr)=>acc+Math.min(curr.get('unread',0),1),0);};// Filter out invalid chats\nconst normalizePanes=function(chats){let panes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:ImmutableList();return panes.filter(pane=>chats.get(pane.get('chat_id')));};const makeNormalizeChatPanes=()=>createSelector([state=>state.getIn(['chats','items']),state=>getSettings(state).getIn(['chats','panes'])],normalizePanes);const makeMapStateToProps=()=>{const mapStateToProps=state=>{const normalizeChatPanes=makeNormalizeChatPanes();return{panes:normalizeChatPanes(state),mainWindowState:getSettings(state).getIn(['chats','mainWindow']),unreadCount:getChatsUnreadCount(state)};};return mapStateToProps;};let ChatPanes=(_dec=connect(makeMapStateToProps),_dec(_class=injectIntl(_class=withRouter(_class=(_class2=class ChatPanes extends ImmutablePureComponent{constructor(){super(...arguments);_defineProperty(this,\"handleClickChat\",chat=>{this.props.dispatch(openChat(chat.get('id')));});_defineProperty(this,\"handleSuggestion\",accountId=>{this.props.dispatch(launchChat(accountId,this.props.history));});_defineProperty(this,\"handleMainWindowToggle\",()=>{this.props.dispatch(toggleMainWindow());});}render(){const{intl,panes,mainWindowState,unreadCount}=this.props;const open=mainWindowState==='open';const mainWindowPane=/*#__PURE__*/_jsx(\"div\",{className:\"pane pane--main pane--\".concat(mainWindowState)},void 0,/*#__PURE__*/_jsx(\"div\",{className:\"pane__header\"},void 0,unreadCount>0&&/*#__PURE__*/_jsx(\"i\",{className:\"icon-with-badge__badge\"},void 0,shortNumberFormat(unreadCount)),/*#__PURE__*/_jsx(\"button\",{className:\"pane__title\",onClick:this.handleMainWindowToggle},void 0,/*#__PURE__*/_jsx(FormattedMessage,{id:\"chat_panels.main_window.title\",defaultMessage:\"Chats\"})),/*#__PURE__*/_jsx(AudioToggle,{})),/*#__PURE__*/_jsx(\"div\",{className:\"pane__content\"},void 0,open&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/_jsx(ChatList,{onClickChat:this.handleClickChat}),/*#__PURE__*/_jsx(AccountSearch,{placeholder:intl.formatMessage(messages.searchPlaceholder),onSelected:this.handleSuggestion}))));return/*#__PURE__*/_jsx(\"div\",{className:\"chat-panes\"},void 0,mainWindowPane,panes.map((pane,i)=>/*#__PURE__*/_jsx(ChatWindow,{idx:i,chatId:pane.get('chat_id'),windowState:pane.get('state')},pane.get('chat_id'))));}},_defineProperty(_class2,\"propTypes\",{intl:PropTypes.object.isRequired,dispatch:PropTypes.func.isRequired,mainWindowState:PropTypes.string,panes:ImmutablePropTypes.list,history:PropTypes.object}),_class2))||_class)||_class)||_class);export{ChatPanes as default};"],"names":["_class","_class2","ChatWindow","getChat","state","_ref","chatId","chat","getIn","me","get","toJS","undefined","displayFqn","_dec","injectIntl","arguments","content","e","props","dispatch","setState","target","value","el","inputElem","focusInput","focus","componentDidUpdate","prevProps","oldState","windowState","newState","this","render","idx","account","right","unreadCount","unreadIcon","className","avatar","accountId","to","concat","size","style","onClick","handleChatToggle","src","title","handleChatClose","onSetInputRef","handleInputRef","intl","messages","searchPlaceholder","getChatsUnreadCount","reduce","acc","curr","Math","min","normalizePanes","chats","panes","length","filter","pane","ChatPanes","normalizeChatPanes","mainWindowState","history","open","mainWindowPane","handleMainWindowToggle","id","defaultMessage","onClickChat","handleClickChat","placeholder","formatMessage","onSelected","handleSuggestion","map","i"],"sourceRoot":""}